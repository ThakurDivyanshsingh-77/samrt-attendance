<!-- PAGE WRAPPER -->
<div
  class="min-h-screen p-10
         bg-gradient-to-br from-slate-100 via-indigo-50 to-purple-100
         space-y-12">

  <!-- PAGE HEADER + BACK BUTTON -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">

    <div>
      <h1 class="text-3xl font-extrabold text-gray-800">
        Attendance History
      </h1>
      <p class="text-gray-600 mt-1">
        View and analyze your past attendance sessions
      </p>
    </div>

    <!-- BACK BUTTON -->
    <button
      href="teacher.html"
      class="inline-flex items-center gap-2
             px-5 py-2.5 rounded-xl
             bg-white shadow-md hover:shadow-lg
             text-indigo-600 font-semibold
             transition">
      ‚Üê Back to Dashboard
    </button>

  </div>

  <!-- FILTER CARD -->
  <div class="bg-white rounded-3xl shadow-xl p-8">

    <h2 class="text-xl font-semibold text-gray-800 mb-6">
      Filters
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

      <!-- SUBJECT -->
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Subject</mat-label>
        <mat-select [formControl]="subjectControl">
          <mat-option value="">View All Subject</mat-option>
          <mat-option *ngFor="let s of subjects" [value]="s._id">
            {{ s.name }} ({{ s.code }})
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- FROM DATE -->
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>From Date</mat-label>
        <input matInput [matDatepicker]="fromPicker" [formControl]="fromDateControl">
        <mat-datepicker-toggle matSuffix [for]="fromPicker"></mat-datepicker-toggle>
        <mat-datepicker #fromPicker></mat-datepicker>
      </mat-form-field>

      <!-- TO DATE -->
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>To Date</mat-label>
        <input matInput [matDatepicker]="toPicker" [formControl]="toDateControl">
        <mat-datepicker-toggle matSuffix [for]="toPicker"></mat-datepicker-toggle>
        <mat-datepicker #toPicker></mat-datepicker>
      </mat-form-field>

    </div>
  </div>

  <!-- LOADING -->
  <div *ngIf="loading" class="flex justify-center py-20">
    <mat-spinner diameter="50"></mat-spinner>
  </div>

  <!-- TABLE CARD -->
  <div
    *ngIf="!loading"
    class="bg-white rounded-3xl shadow-xl p-8">

    <h2 class="text-xl font-semibold text-gray-800 mb-6">
      Session Records
    </h2>

    <div class="overflow-x-auto">

      <table
        mat-table
        [dataSource]="filteredSessions"
        class="w-full">

        <!-- SUBJECT -->
        <ng-container matColumnDef="subject">
          <th mat-header-cell *matHeaderCellDef>Subject</th>
          <td mat-cell *matCellDef="let s">
            {{ s.subject.name }} ({{ s.subject.code }})
          </td>
        </ng-container>

        <!-- DATE -->
        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef>Date</th>
          <td mat-cell *matCellDef="let s">
            {{ s.startTime | date:'medium' }}
          </td>
        </ng-container>

        <!-- PRESENT -->
        <ng-container matColumnDef="present">
          <th mat-header-cell *matHeaderCellDef>Present</th>
          <td mat-cell *matCellDef="let s">
            {{ s.totalPresent }}
          </td>
        </ng-container>

        <!-- STATUS -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let s">
            <span
              class="px-3 py-1 rounded-full text-xs font-semibold"
              [ngClass]="
                s.isExpired
                  ? 'bg-green-100 text-green-700'
                  : 'bg-indigo-100 text-indigo-700'
              ">
              {{ s.isExpired ? 'Completed' : 'Active' }}
            </span>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      </table>
    </div>

    <!-- EMPTY STATE -->
    <div
      *ngIf="filteredSessions.length === 0"
      class="text-center py-16 text-gray-500">
      No attendance found for selected filters.
    </div>
  </div>

  <!-- MONTHLY SUMMARY -->
  <div class="bg-white rounded-3xl shadow-xl p-8">

    <h2 class="text-xl font-semibold text-gray-800 mb-6">
      Monthly Summary
    </h2>

    <div class="overflow-x-auto">

      <table
        mat-table
        [dataSource]="monthlySummary"
        class="w-full">

        <ng-container matColumnDef="month">
          <th mat-header-cell *matHeaderCellDef>Month</th>
          <td mat-cell *matCellDef="let m">{{ m.month }}</td>
        </ng-container>

        <ng-container matColumnDef="sessions">
          <th mat-header-cell *matHeaderCellDef>Sessions</th>
          <td mat-cell *matCellDef="let m">{{ m.sessions }}</td>
        </ng-container>

        <ng-container matColumnDef="present">
          <th mat-header-cell *matHeaderCellDef>Total Present</th>
          <td mat-cell *matCellDef="let m">{{ m.present }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="['month','sessions','present']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['month','sessions','present'];"></tr>

      </table>
    </div>
  </div>

  <!-- CHART -->
  <div class="bg-white rounded-3xl shadow-xl p-8">

    <h2 class="text-xl font-semibold text-gray-800 mb-6">
      Attendance Trend
    </h2>

    <div class="h-[400px]">
      <canvas
        baseChart
        [data]="chartData"
        [type]="chartType">
      </canvas>
    </div>
  </div>

</div>
