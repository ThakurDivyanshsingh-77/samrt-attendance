<mat-card class="reports-card">

  <h2>Attendance History</h2>

  <!-- FILTER ROW -->
  <div class="filters">

    <!-- SUBJECT -->
    <mat-form-field appearance="outline">
      <mat-label>Subject</mat-label>
      <mat-select [formControl]="subjectControl">
        <mat-option value="">All Subjects</mat-option>
        <mat-option *ngFor="let s of subjects" [value]="s._id">
          {{ s.name }} ({{ s.code }})
        </mat-option>
      </mat-select>
    </mat-form-field>

    <!-- FROM DATE -->
    <mat-form-field appearance="outline">
      <mat-label>From Date</mat-label>
      <input matInput [matDatepicker]="fromPicker" [formControl]="fromDateControl">
      <mat-datepicker-toggle matSuffix [for]="fromPicker"></mat-datepicker-toggle>
      <mat-datepicker #fromPicker></mat-datepicker>
    </mat-form-field>

    <!-- TO DATE -->
    <mat-form-field appearance="outline">
      <mat-label>To Date</mat-label>
      <input matInput [matDatepicker]="toPicker" [formControl]="toDateControl">
      <mat-datepicker-toggle matSuffix [for]="toPicker"></mat-datepicker-toggle>
      <mat-datepicker #toPicker></mat-datepicker>
    </mat-form-field>

  </div>

  <!-- LOADING -->
  <div *ngIf="loading" class="loading">
    <mat-spinner></mat-spinner>
  </div>

  <!-- TABLE -->
  <table mat-table [dataSource]="filteredSessions" *ngIf="!loading">

    <ng-container matColumnDef="subject">
      <th mat-header-cell *matHeaderCellDef>Subject</th>
      <td mat-cell *matCellDef="let s">
        {{ s.subject.name }} ({{ s.subject.code }})
      </td>
    </ng-container>

    <ng-container matColumnDef="date">
      <th mat-header-cell *matHeaderCellDef>Date</th>
      <td mat-cell *matCellDef="let s">
        {{ s.startTime | date:'medium' }}
      </td>
    </ng-container>

    <ng-container matColumnDef="present">
      <th mat-header-cell *matHeaderCellDef>Present</th>
      <td mat-cell *matCellDef="let s">
        {{ s.totalPresent }}
      </td>
    </ng-container>

    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef>Status</th>
      <td mat-cell *matCellDef="let s">
        {{ s.isExpired ? 'Completed' : 'Active' }}
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

  </table>

  <p *ngIf="!loading && filteredSessions.length === 0" class="empty">
    No attendance found for selected filters.
  </p>
<h3>ðŸ“Š Monthly Summary</h3>

<table mat-table [dataSource]="monthlySummary" class="summary-table">

  <ng-container matColumnDef="month">
    <th mat-header-cell *matHeaderCellDef>Month</th>
    <td mat-cell *matCellDef="let m">{{ m.month }}</td>
  </ng-container>

  <ng-container matColumnDef="sessions">
    <th mat-header-cell *matHeaderCellDef>Sessions</th>
    <td mat-cell *matCellDef="let m">{{ m.sessions }}</td>
  </ng-container>

  <ng-container matColumnDef="present">
    <th mat-header-cell *matHeaderCellDef>Total Present</th>
    <td mat-cell *matCellDef="let m">{{ m.present }}</td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="['month','sessions','present']"></tr>
  <tr mat-row *matRowDef="let row; columns: ['month','sessions','present'];"></tr>
</table>

</mat-card>
<mat-card>
  <h3>Monthly Attendance Trend</h3>

  <canvas
    baseChart
    [data]="chartData"
    [type]="chartType">
  </canvas>
</mat-card>
