<!-- ================= TOP BAR ================= -->
<mat-toolbar
  class="bg-blue/80 backdrop-blur-xl border-b border-white/20
         text-gray-900 px-8 flex justify-between shadow-sm">

  <div class="flex items-center gap-3 text-lg font-semibold">
    <mat-icon class="text-indigo-600">school</mat-icon>
    Student Dashboard
  </div>

  <div class="flex items-center gap-3">
    <span class="hidden sm:block text-sm font-medium">
      {{ user?.name }}
    </span>

    <button mat-icon-button [matMenuTriggerFor]="menu">
      <mat-icon>account_circle</mat-icon>
    </button>

    <mat-menu #menu="matMenu">
      <button mat-menu-item (click)="logout()">
        <mat-icon>exit_to_app</mat-icon>
        Logout
      </button>
    </mat-menu>
  </div>
</mat-toolbar>

<!-- ================= PAGE BACKDROP ================= -->
<div
  class="min-h-screen px-6 py-10
         bg-gradient-to-br from-indigo-900 via-purple-900 to-fuchsia-900">

  <!-- ================= HERO GLASS ================= -->
  <div
    class="max-w-6xl mx-auto mb-14
           bg-white/10 backdrop-blur-2xl
           border border-white/20
           rounded-[2.5rem] p-10
           shadow-[0_40px_120px_rgba(0,0,0,0.7)]">

    <h1 class="text-4xl font-extrabold text-white tracking-wide">
      Welcome, {{ user?.name }} ðŸ‘‹
    </h1>

    <p class="mt-4 text-white/80 text-lg">
      Roll {{ user?.rollNumber }} â€¢ Year {{ user?.year }} â€¢ Semester {{ user?.semester }}
    </p>
  </div>

  <!-- ================= OVERALL ATTENDANCE ================= -->
  <div
    *ngIf="stats?.overall"
    class="max-w-6xl mx-auto mb-16
           bg-white/10 backdrop-blur-2xl
           border border-white/20
           rounded-[2.5rem] p-12 text-center
           shadow-[0_40px_120px_rgba(0,0,0,0.6)]">

    <div
      class="text-[6rem] font-extrabold"
      [ngClass]="{
        'text-emerald-400': stats?.overall?.percentage >= 75,
        'text-amber-400': stats?.overall?.percentage >= 60 && stats?.overall?.percentage < 75,
        'text-rose-400': stats?.overall?.percentage < 60
      }">

      {{ stats?.overall?.percentage ?? 0 }}%
    </div>

    <p class="mt-4 text-white/80 text-lg">
      {{ stats?.overall?.attended ?? 0 }} /
      {{ stats?.overall?.total ?? 0 }}
      Classes Attended
    </p>
  </div>

  <!-- ================= ACTION CARDS ================= -->
  <div
    class="max-w-6xl mx-auto grid grid-cols-1 sm:grid-cols-3 gap-10 mb-20">

    <!-- MARK -->
    <div
      (click)="markAttendance()"
      class="cursor-pointer rounded-[2rem]
             bg-gradient-to-r from-indigo-500 to-blue-500
             p-8 text-white shadow-2xl
             hover:scale-105 transition">

      <mat-icon class="text-4xl mb-4">how_to_reg</mat-icon>
      <h3 class="text-2xl font-bold">Mark Attendance</h3>
      <p class="mt-2 text-white/80">
        Enter live session code
      </p>
    </div>

    <!-- REPORTS -->
    <div
      (click)="viewReports()"
      class="cursor-pointer rounded-[2rem]
             bg-gradient-to-r from-pink-500 to-fuchsia-500
             p-8 text-white shadow-2xl
             hover:scale-105 transition">

      <mat-icon class="text-4xl mb-4">assessment</mat-icon>
      <h3 class="text-2xl font-bold">Reports</h3>
      <p class="mt-2 text-white/80">
        Analytics & insights
      </p>
    </div>

    <!-- HISTORY -->
    <div
      (click)="viewHistory()"
      class="cursor-pointer rounded-[2rem]
             bg-white/90 text-gray-900
             p-8 shadow-2xl
             hover:scale-105 transition">

      <mat-icon class="text-4xl mb-4">history</mat-icon>
      <h3 class="text-2xl font-bold">History</h3>
      <p class="mt-2 text-gray-600">
        Past attendance records
      </p>
    </div>

  </div>

  <!-- ================= SUBJECT WISE ================= -->
  <div *ngIf="stats?.subjectStats?.length"
       class="max-w-6xl mx-auto">

    <h2 class="text-3xl font-bold text-white mb-10">
      Subject-wise Attendance
    </h2>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-10">

      <div
        *ngFor="let s of stats?.subjectStats"
        class="bg-white/10 backdrop-blur-xl
               border border-white/20
               rounded-[2rem] p-8
               shadow-xl hover:shadow-2xl transition">

        <h3 class="text-xl font-semibold text-white">
          {{ s?.subject?.name }}
        </h3>

        <p class="text-sm text-white/70 mb-4">
          {{ s?.subject?.code }}
        </p>

        <div class="h-3 bg-white/20 rounded-full overflow-hidden mb-4">
          <div
            class="h-full transition-all"
            [style.width.%]="s?.percentage ?? 0"
            [ngClass]="{
              'bg-emerald-400': s?.percentage >= 75,
              'bg-amber-400': s?.percentage >= 60 && s?.percentage < 75,
              'bg-rose-400': s?.percentage < 60
            }">
          </div>
        </div>

        <p class="text-center text-white/90 font-semibold">
          {{ s?.percentage ?? 0 }}%
          ({{ s?.attended ?? 0 }}/{{ s?.total ?? 0 }})
        </p>

      </div>

    </div>
  </div>

</div>
